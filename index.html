<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OR Algorithm Lab – Interaktive Demos (TSP · Flow‑Shop)</title>
  <meta name="description" content="Interaktive Demos für Operations Research & Optimierung: TSP (Nearest Neighbor + 2‑Opt) und Flow‑Shop Scheduling (NEH). 100% clientseitig – ideal für GitHub Pages." />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html { scroll-behavior: smooth; }
    :focus-visible { outline: 2px solid #6366f1; outline-offset: 2px; }
    .btn { @apply inline-flex items-center gap-2 rounded-2xl px-4 py-2 text-sm font-semibold shadow-sm hover:shadow; }
    .btn-primary { @apply bg-indigo-600 text-white hover:bg-indigo-700; }
    .btn-ghost { @apply bg-white/80 hover:bg-white; }
    .badge { @apply inline-flex items-center rounded-full border border-indigo-200 bg-indigo-50 px-2 py-0.5 text-xs text-indigo-700; }
    .stat { @apply rounded-2xl bg-white/80 p-3 shadow-sm ring-1 ring-black/5; }
    .card { @apply rounded-2xl bg-white/80 p-4 shadow ring-1 ring-black/5; }
    .tab-active { @apply bg-indigo-600 text-white; }
    .hidden-sec { display:none; }
    #tspCanvasWrap, #fsCanvasWrap { aspect-ratio: 16/10; }
    code { @apply rounded bg-slate-100 px-1 py-0.5; }
    pre { @apply rounded-xl bg-slate-900 p-4 text-slate-100 overflow-auto text-sm; }
    /* Simple tooltip */
    .tip { @apply pointer-events-none absolute right-3 top-3 rounded-full bg-white/80 px-3 py-1 text-xs font-medium text-slate-600 shadow; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 text-slate-800">
  <!-- NAV -->
  <header class="sticky top-0 z-40 backdrop-blur bg-white/70 ring-1 ring-black/5">
    <div class="mx-auto flex max-w-7xl items-center justify-between px-4 py-3">
      <div class="flex items-center gap-2">
        <div class="h-8 w-8 rounded-xl bg-indigo-600"></div>
        <span class="text-lg font-bold">OR Algorithm Lab</span>
        <span class="ml-2 hidden text-xs text-slate-600 md:inline">TSP · Scheduling · Heuristics</span>
      </div>
      <nav class="flex items-center gap-2">
        <a href="#demos" class="btn btn-ghost">Demos</a>
        <a href="#cases" class="btn btn-ghost">Case Studies</a>
        <a href="#about" class="btn btn-ghost">Über mich</a>
        <a href="#contact" class="btn btn-primary">Kontakt</a>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="mx-auto max-w-7xl px-4 pt-10">
    <div class="grid items-center gap-6 md:grid-cols-2">
      <div>
        <h1 class="text-3xl font-bold tracking-tight md:text-4xl">Praktische Optimierung – live im Browser</h1>
        <p class="mt-3 text-slate-600">Interaktive Mini‑Apps zeigen, wie Heuristiken Touren verkürzen und Durchlaufzeiten senken. 100% clientseitig – ideal zum schnellen Ausprobieren und für Erstgespräche.</p>
        <div class="mt-4 flex flex-wrap gap-2 text-sm">
          <span class="badge">TSP (NN + 2‑Opt)</span>
          <span class="badge">Flow‑Shop (NEH)</span>
          <span class="badge">Gantt‑Charts</span>
          <span class="badge">PNG/CSV‑Export</span>
        </div>
        <div class="mt-6 flex gap-2">
          <a href="#demos" class="btn btn-primary">Zu den Demos</a>
          <a href="#cases" class="btn btn-ghost">Ergebnisse ansehen</a>
        </div>
      </div>
      <div class="card">
        <p class="mb-2 text-sm font-medium text-slate-700">Pseudocode (2‑Opt – First Improvement)</p>
<pre><code>repeat
  improved = false
  for i = 1..n-3
    for j = i+1..n-1
      if SwapGain(i, j) &gt; 0 then
        Reverse(path[i..j])
        improved = true; break
      end
    end
    if improved then break
  end
until not improved</code></pre>
        <p class="mt-2 text-xs text-slate-500">Erklärfokus, keine Kundendaten. Kernideen klar &amp; visuell.</p>
      </div>
    </div>
  </section>

  <!-- DEMOS -->
  <section id="demos" class="mx-auto mt-10 max-w-7xl px-4">
    <!-- Tabs -->
    <div class="flex w-full gap-2 rounded-2xl bg-white/80 p-1 shadow ring-1 ring-black/5">
      <button data-tab="tsp" class="tab btn w-full justify-center tab-active">Tourenplanung (TSP)</button>
      <button data-tab="flowshop" class="tab btn w-full justify-center">Flow‑Shop Scheduling (NEH)</button>
    </div>

    <!-- TSP Panel -->
    <section id="panel-tsp" class="mt-6">
      <div class="card">
        <div class="grid grid-cols-1 gap-4 md:grid-cols-3 md:items-end">
          <div>
            <label for="tspNum" class="block text-sm font-medium text-slate-700">Anzahl Punkte</label>
            <input id="tspNum" type="range" min="5" max="200" value="40" class="mt-2 w-full" />
            <div class="mt-1 text-xs text-slate-600"><span id="tspNumLabel">40</span> Punkte</div>
          </div>
          <div class="flex flex-wrap items-center gap-2">
            <button id="tspGen" class="btn btn-ghost">Punkte erzeugen</button>
            <button id="tspAddMode" class="btn btn-ghost">Punkte hinzufügen: <span id="tspAddState">aus</span></button>
          </div>
          <div class="flex flex-wrap items-center gap-2">
            <button id="tspSolve" class="btn btn-primary">NN + 2‑Opt</button>
            <button id="tspStep" class="btn btn-ghost">2‑Opt (ein Schritt)</button>
            <button id="tspReset" class="btn btn-ghost">Zurücksetzen</button>
          </div>
        </div>
        <div class="mt-4 grid grid-cols-2 gap-3 md:grid-cols-4">
          <div class="stat"><div class="text-xs text-slate-500">Punkte</div><div class="text-lg font-semibold" id="tspStatPts">0</div></div>
          <div class="stat"><div class="text-xs text-slate-500">Distanz (aktuell)</div><div class="text-lg font-semibold" id="tspStatDist">–</div></div>
          <div class="stat"><div class="text-xs text-slate-500">Verbesserung</div><div class="text-lg font-semibold" id="tspStatImp">–</div></div>
          <div class="stat"><div class="text-xs text-slate-500">Iterationen</div><div class="text-lg font-semibold" id="tspStatIt">0</div></div>
        </div>
      </div>
      <div id="tspCanvasWrap" class="relative mt-6 w-full overflow-hidden rounded-2xl bg-white/80 shadow ring-1 ring-black/5">
        <canvas id="tspCanvas" class="block w-full"></canvas>
        <div class="tip">Klicke, um Punkte hinzuzufügen (wenn aktiv)</div>
      </div>
      <p class="mt-3 text-xs text-slate-500">TSP als Rundtour; euklidische Distanz. Startlösung: Nearest Neighbor, danach lokale Suche (2‑Opt).</p>
      <div class="mt-4 flex gap-2">
        <button id="tspPNG" class="btn btn-ghost">PNG exportieren</button>
        <button id="tspCSV" class="btn btn-ghost">CSV exportieren</button>
      </div>
    </section>

    <!-- FLOWSHOP Panel -->
    <section id="panel-flowshop" class="mt-6 hidden-sec">
      <div class="card">
        <div class="grid grid-cols-1 gap-4 md:grid-cols-4 md:items-end">
          <div>
            <label for="fsJobs" class="block text-sm font-medium text-slate-700">Jobs</label>
            <input id="fsJobs" type="range" min="3" max="25" value="8" class="mt-2 w-full" />
            <div class="mt-1 text-xs text-slate-600"><span id="fsJobsLabel">8</span> Jobs</div>
          </div>
          <div>
            <label for="fsMach" class="block text-sm font-medium text-slate-700">Maschinen</label>
            <input id="fsMach" type="range" min="2" max="8" value="4" class="mt-2 w-full" />
            <div class="mt-1 text-xs text-slate-600"><span id="fsMachLabel">4</span> Maschinen</div>
          </div>
          <div class="flex flex-wrap items-center gap-2">
            <button id="fsGen" class="btn btn-ghost">Daten erzeugen</button>
            <button id="fsRandOrder" class="btn btn-ghost">Zufallsreihenfolge</button>
            <button id="fsNEH" class="btn btn-primary">NEH berechnen</button>
          </div>
          <div class="flex flex-wrap items-center gap-2">
            <button id="fsPNG" class="btn btn-ghost">Gantt als PNG</button>
          </div>
        </div>
        <div class="mt-4 grid grid-cols-2 gap-3 md:grid-cols-4">
          <div class="stat"><div class="text-xs text-slate-500">Reihenfolge</div><div class="text-lg font-semibold" id="fsOrder">–</div></div>
          <div class="stat"><div class="text-xs text-slate-500">Makespan</div><div class="text-lg font-semibold" id="fsMakespan">–</div></div>
          <div class="stat"><div class="text-xs text-slate-500">NEH Makespan</div><div class="text-lg font-semibold" id="fsMakespanNEH">–</div></div>
          <div class="stat"><div class="text-xs text-slate-500">Verbesserung</div><div class="text-lg font-semibold" id="fsImprove">–</div></div>
        </div>
      </div>
      <div id="fsCanvasWrap" class="relative mt-6 w-full overflow-hidden rounded-2xl bg-white/80 shadow ring-1 ring-black/5">
        <canvas id="fsCanvas" class="block w-full"></canvas>
        <div class="tip">Gantt‑Chart (Job × Maschine); Zoom durch Fenstergröße</div>
      </div>
      <p class="mt-3 text-xs text-slate-500">Flow‑Shop: Jede Operation <em>J</em> läuft nacheinander auf Maschinen 1..M. Algorithmus: <strong>NEH</strong> (Nawaz–Enscore–Ham, 1983) mit Einfügeheuristik; Kennzahl: Makespan.</p>
    </section>
  </section>

  <!-- CASE STUDIES -->
  <section id="cases" class="mx-auto mt-12 max-w-7xl px-4">
    <h2 class="text-2xl font-bold">Case Studies (synthetisch)</h2>
    <div class="mt-4 grid gap-4 md:grid-cols-3">
      <article class="card">
        <h3 class="font-semibold">Tourenplanung: 50 Kunden, 3 Fahrzeuge</h3>
        <p class="mt-1 text-sm text-slate-600">Lokale Suche (2‑Opt/Relocate) senkt die Gesamtdistanz um <strong>18–25%</strong> gegenüber Greedy‑Startlösungen.</p>
        <ul class="mt-2 list-inside list-disc text-sm text-slate-600">
          <li>KPIs: Gesamtdistanz, max. Tourzeit</li>
          <li>Visuals: Vorher/‑Nachher‑Routen</li>
        </ul>
      </article>
      <article class="card">
        <h3 class="font-semibold">Flow‑Shop: 12 Jobs × 5 Maschinen</h3>
        <p class="mt-1 text-sm text-slate-600">NEH reduziert den Makespan konsistent um <strong>10–20%</strong> ggü. Zufallsreihenfolgen.</p>
        <ul class="mt-2 list-inside list-disc text-sm text-slate-600">
          <li>KPIs: Makespan, WIP</li>
          <li>Visuals: Gantt‑Charts</li>
        </ul>
      </article>
      <article class="card">
        <h3 class="font-semibold">Auftragsplanung mit Deadlines</h3>
        <p class="mt-1 text-sm text-slate-600">Dispatching‑Regeln (SPT/EDD) zeigen Trade‑offs zwischen Durchsatz und Tardiness.</p>
        <ul class="mt-2 list-inside list-disc text-sm text-slate-600">
          <li>KPIs: Tardiness, On‑time‑Rate</li>
          <li>Visuals: Gantt &amp; Pareto‑Punkte</li>
        </ul>
      </article>
    </div>
  </section>

  <!-- ABOUT -->
  <section id="about" class="mx-auto mt-12 max-w-7xl px-4">
    <h2 class="text-2xl font-bold">Methodik & Stack</h2>
    <div class="mt-4 grid gap-4 md:grid-cols-2">
      <div class="card">
        <h3 class="font-semibold">Ansatz</h3>
        <ul class="mt-2 list-inside list-disc text-sm text-slate-700">
          <li>Strukturierte Problemaufnahme &amp; KPIs definieren</li>
          <li>Baseline &amp; Heuristiken (Greedy, lokale Suche)</li>
          <li>Pragmatische Hybride (Matheuristics, Fix‑and‑Optimize)</li>
          <li>Validerung mit synthetischen &amp; realen Daten</li>
        </ul>
      </div>
      <div class="card">
        <h3 class="font-semibold">Tech (für Demos)</h3>
        <ul class="mt-2 list-inside list-disc text-sm text-slate-700">
          <li>JavaScript + Canvas (Client‑side)</li>
          <li>TailwindCSS via CDN</li>
          <li>GitHub Pages Deployment</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- CONTACT -->
  <section id="contact" class="mx-auto my-12 max-w-7xl px-4">
    <div class="card">
      <h2 class="text-2xl font-bold">Kontakt</h2>
      <p class="mt-1 text-sm text-slate-600">Haben Sie ein ähnliches Problem? Ich biete ein 30‑minütiges Erstgespräch.</p>
      <div class="mt-3 flex flex-wrap gap-2 text-sm">
        <a href="mailto:kontakt@example.com?subject=OR%20Demo%20Anfrage" class="btn btn-primary">Per E‑Mail anfragen</a>
        <a href="#" class="btn btn-ghost">LinkedIn</a>
        <a href="#" class="btn btn-ghost">GitHub</a>
      </div>
      <p class="mt-2 text-xs text-slate-500">Diese Demos verwenden nur synthetische Daten und speichern nichts.</p>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="mx-auto mb-10 max-w-7xl px-4 text-xs text-slate-500">
    <div class="rounded-2xl bg-white/60 p-4 ring-1 ring-black/5">© <span id="year"></span> OR Algorithm Lab · Demo‑Seite für GitHub Pages · <a class="underline" href="#">Impressum</a> · <a class="underline" href="#">Datenschutz</a></div>
  </footer>

  <!-- ====== SCRIPT ====== -->
  <script>
  // ========= Utilities =========
  const $ = (sel) => document.querySelector(sel);
  const $$ = (sel) => Array.from(document.querySelectorAll(sel));
  const clamp = (a, b, c) => Math.max(b, Math.min(c, a));
  function download(name, text, mime='text/plain'){
    const blob = new Blob([text], {type: mime}); const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download=name; a.click(); URL.revokeObjectURL(url);
  }
  $('#year').textContent = new Date().getFullYear();

  // ========= Tabs =========
  $$('.tab').forEach(btn => btn.addEventListener('click', () => {
    $$('.tab').forEach(b => b.classList.remove('tab-active'));
    btn.classList.add('tab-active');
    const t = btn.dataset.tab;
    $('#panel-tsp').classList.toggle('hidden-sec', t !== 'tsp');
    $('#panel-flowshop').classList.toggle('hidden-sec', t !== 'flowshop');
  }));

  // ========= TSP Demo =========
  (function(){
    const cvs = $('#tspCanvas'); const ctx = cvs.getContext('2d', {alpha:false});
    let DPR = Math.max(1, Math.floor(window.devicePixelRatio||1));
    const wrap = $('#tspCanvasWrap');
    let points = []; let order = []; let baseDist = null; let iters=0; let addMode=false;

    function dist(a,b){const dx=a.x-b.x, dy=a.y-b.y; return Math.hypot(dx,dy);}    
    function total(order){let s=0; for(let i=0;i<order.length;i++){const p=points[order[i]], q=points[order[(i+1)%order.length]]; s+=dist(p,q);} return s;}
    function nn(start=0){const n=points.length, used=Array(n).fill(false), ord=[]; let cur=start; used[cur]=true; ord.push(cur); for(let k=1;k<n;k++){let best=-1,bD=1e9; for(let j=0;j<n;j++) if(!used[j]){const d=dist(points[cur], points[j]); if(d<bD){bD=d; best=j;}} used[best]=true; ord.push(best); cur=best;} return ord;}
    function twoOptStep(ord){const n=ord.length; if(n<4) return false; for(let i=1;i<n-2;i++){ for(let j=i+1;j<n;j++){ const a=ord[i-1], b=ord[i], c=ord[j%n], d=ord[(j+1)%n]; const delta = dist(points[a], points[c])+dist(points[b], points[d]) - dist(points[a], points[b]) - dist(points[c], points[d]); if(delta < -1e-9){ for(let l=0;l<Math.floor((j-i+1)/2);l++){ const t=ord[i+l]; ord[i+l]=ord[j-l]; ord[j-l]=t; } return true; } }} return false;}

    function resize(){ const r=wrap.getBoundingClientRect(); const w=Math.floor(r.width), h=Math.floor(r.height); DPR=Math.max(1, Math.floor(window.devicePixelRatio||1)); cvs.width=w*DPR; cvs.height=h*DPR; cvs.style.width=w+'px'; cvs.style.height=h+'px'; ctx.setTransform(DPR,0,0,DPR,0,0); draw();}
    window.addEventListener('resize', resize);

    function drawGrid(){ const w=cvs.width/DPR, h=cvs.height/DPR; ctx.fillStyle='#fff'; ctx.fillRect(0,0,w,h); ctx.strokeStyle='rgba(0,0,0,0.05)'; ctx.lineWidth=1; const step=40; ctx.beginPath(); for(let x=step;x<w;x+=step){ctx.moveTo(x,0);ctx.lineTo(x,h);} for(let y=step;y<h;y+=step){ctx.moveTo(0,y);ctx.lineTo(w,y);} ctx.stroke(); }
    function draw(){ drawGrid(); if(order.length>1){ ctx.lineWidth=2; ctx.strokeStyle='rgba(79,70,229,0.9)'; ctx.beginPath(); const p0=points[order[0]]; ctx.moveTo(p0.x,p0.y); for(let i=1;i<order.length;i++){ const p=points[order[i]]; ctx.lineTo(p.x,p.y);} ctx.lineTo(p0.x,p0.y); ctx.stroke(); } for(const p of points){ ctx.fillStyle='#0ea5e9'; ctx.beginPath(); ctx.arc(p.x,p.y,4.5,0,Math.PI*2); ctx.fill(); } if(order.length){ const s=points[order[0]]; ctx.fillStyle='#ef4444'; ctx.beginPath(); ctx.arc(s.x,s.y,5.5,0,Math.PI*2); ctx.fill(); } }

    function randomPoints(n){ const r=wrap.getBoundingClientRect(); const w=r.width, h=r.height; const pad=24; const arr=[]; for(let i=0;i<n;i++){ arr.push({x: pad+Math.random()*(w-2*pad), y: pad+Math.random()*(h-2*pad)});} return arr; }
    function updateStats(){ $('#tspStatPts').textContent=points.length; if(order.length>1){ const d=total(order); $('#tspStatDist').textContent=d.toFixed(1); if(baseDist!=null){ const imp=((baseDist-d)/baseDist)*100; $('#tspStatImp').textContent=(imp>=0?'−':'+')+Math.abs(imp).toFixed(1)+'%'; } else $('#tspStatImp').textContent='–'; } else { $('#tspStatDist').textContent='–'; $('#tspStatImp').textContent='–'; } $('#tspStatIt').textContent=iters; }

    // UI events
    $('#tspNum').addEventListener('input', ()=> $('#tspNumLabel').textContent=$('#tspNum').value);
    $('#tspGen').addEventListener('click', ()=>{ points=randomPoints(parseInt($('#tspNum').value,10)); order=[]; baseDist=null; iters=0; draw(); updateStats(); });
    $('#tspAddMode').addEventListener('click', ()=>{ addMode=!addMode; $('#tspAddState').textContent=addMode?'an':'aus'; });
    cvs.addEventListener('click', (e)=>{ if(!addMode) return; const r=cvs.getBoundingClientRect(); const x=(e.clientX-r.left)*(cvs.width/DPR/r.width); const y=(e.clientY-r.top)*(cvs.height/DPR/r.height); points.push({x,y}); order=[]; baseDist=null; iters=0; draw(); updateStats(); });
    $('#tspSolve').addEventListener('click', ()=>{ if(points.length<3) return; order=nn(0); baseDist=total(order); let improved=true; iters=0; const MAX=5000; while(improved && iters<MAX){ improved=twoOptStep(order); iters++; } draw(); updateStats(); });
    $('#tspStep').addEventListener('click', ()=>{ if(points.length<4) return; if(!order.length){ order=nn(0); baseDist=total(order);} if(twoOptStep(order)) iters++; draw(); updateStats(); });
    $('#tspReset').addEventListener('click', ()=>{ order=[]; baseDist=null; iters=0; draw(); updateStats(); });
    $('#tspPNG').addEventListener('click', ()=>{ download('tsp_demo.png', cvs.toDataURL('image/png')); });
    $('#tspCSV').addEventListener('click', ()=>{ const rows=['x,y', ...points.map(p=>`${p.x.toFixed(3)},${p.y.toFixed(3)}`)]; download('points.csv', rows.join('
'), 'text/csv'); });

    // init
    function init(){ resize(); points=randomPoints(parseInt($('#tspNum').value,10)); draw(); updateStats(); }
    function resize(){ const r=wrap.getBoundingClientRect(); const w=Math.floor(r.width), h=Math.floor(r.height); DPR=Math.max(1, Math.floor(window.devicePixelRatio||1)); cvs.width=w*DPR; cvs.height=h*DPR; cvs.style.width=w+'px'; cvs.style.height=h+'px'; ctx.setTransform(DPR,0,0,DPR,0,0); draw(); }
    window.addEventListener('resize', resize);
    init();
  })();

  // ========= Flow‑Shop (NEH) =========
  (function(){
    const cvs = $('#fsCanvas'); const ctx = cvs.getContext('2d', {alpha:false});
    let DPR = Math.max(1, Math.floor(window.devicePixelRatio||1));
    const wrap = $('#fsCanvasWrap');
    let P = []; // processing times: P[job][mach]
    let order = []; let orderNEH = []; let makespan = null; let makespanNEH=null;

    function resize(){ const r=wrap.getBoundingClientRect(); const w=Math.floor(r.width), h=Math.floor(r.height); DPR=Math.max(1, Math.floor(window.devicePixelRatio||1)); cvs.width=w*DPR; cvs.height=h*DPR; cvs.style.width=w+'px'; cvs.style.height=h+'px'; ctx.setTransform(DPR,0,0,DPR,0,0); draw(); }
    window.addEventListener('resize', resize);

    function genData(nJobs, nMach){ P = Array.from({length:nJobs}, ()=> Array.from({length:nMach}, ()=> 1+Math.floor(Math.random()*49))); order = Array.from({length:nJobs}, (_,i)=>i); orderNEH=[]; makespan=null; makespanNEH=null; draw(); updateStats(); }

    function makespanOf(seq){ const n=seq.length, m=P[0].length; const C = Array.from({length:n}, ()=> Array(m).fill(0)); for(let i=0;i<n;i++){ for(let j=0;j<m;j++){ const pt = P[seq[i]][j]; const cPrevJob = i>0 ? C[i-1][j] : 0; const cPrevMach = j>0 ? C[i][j-1] : 0; const start = Math.max(cPrevJob, cPrevMach); C[i][j] = start + pt; } } return {C, value: C[n-1][P[0].length-1]}; }

    function NEH(){ const n=P.length, m=P[0].length; const sums = Array.from({length:n}, (_,i)=>({i, s: P[i].reduce((a,b)=>a+b,0)})); sums.sort((a,b)=> b.s - a.s); let seq=[sums[0].i]; for(let k=1;k<n;k++){ const job = sums[k].i; let bestSeq=null, best=Infinity; for(let pos=0; pos<=seq.length; pos++){ const trial=[...seq.slice(0,pos), job, ...seq.slice(pos)]; const val=makespanOf(trial).value; if(val<best){best=val; bestSeq=trial;} } seq=bestSeq; } return seq; }

    function draw(){ const w=cvs.width/DPR, h=cvs.height/DPR; ctx.fillStyle='#fff'; ctx.fillRect(0,0,w,h); if(!P.length || !order.length) return; // draw gantt for current 'best' (prefer NEH if exists)
      const seq = orderNEH.length ? orderNEH : order; const {C} = makespanOf(seq); const m=P[0].length; const n=seq.length; const pad=32; const rowH = Math.max(18, (h-2*pad)/m - 6); const gap=6; const maxT = C[n-1][m-1]; const scale = (w-2*pad)/Math.max(1,maxT);
      // axes
      ctx.strokeStyle='rgba(0,0,0,0.1)'; ctx.lineWidth=1; ctx.beginPath(); for(let t=0;t<=maxT;t+=Math.ceil(maxT/10)){ const x=pad+t*scale; ctx.moveTo(x,pad-6); ctx.lineTo(x,h-pad+6);} ctx.stroke();
      // rows labels
      ctx.fillStyle='#334155'; ctx.font='12px ui-sans-serif'; for(let j=0;j<m;j++){ ctx.fillText('M'+(j+1), 6, pad + j*(rowH+gap) + rowH*0.7); }
      // bars
      for(let i=0;i<n;i++){
        for(let j=0;j<m;j++){
          const end = C[i][j]; const start = end - P[seq[i]][j]; const x = pad + start*scale; const y = pad + j*(rowH+gap);
          ctx.fillStyle = 'rgba(79,70,229,0.85)'; ctx.fillRect(x,y, Math.max(1,(end-start)*scale), rowH);
          ctx.fillStyle = 'rgba(255,255,255,0.9)'; ctx.font='11px ui-sans-serif'; ctx.fillText('J'+(seq[i]+1), x+4, y+rowH*0.66);
        }
      }
      // timeline
      ctx.fillStyle='#334155'; ctx.font='12px ui-sans-serif'; ctx.fillText('Zeit →', w-60, h-8);
    }

    function updateStats(){ const ordTxt = (orderNEH.length?orderNEH:order).map(i=>'J'+(i+1)).join('→'); $('#fsOrder').textContent = ordTxt || '–'; $('#fsMakespan').textContent = makespan!=null? makespan : '–'; $('#fsMakespanNEH').textContent = makespanNEH!=null? makespanNEH : '–'; let imp='–'; if(makespan!=null && makespanNEH!=null){ const p = ((makespan - makespanNEH)/makespan)*100; imp = (p>=0?'−':'+')+Math.abs(p).toFixed(1)+'%'; } $('#fsImprove').textContent = imp; }

    // UI
    $('#fsJobs').addEventListener('input', ()=> $('#fsJobsLabel').textContent=$('#fsJobs').value);
    $('#fsMach').addEventListener('input', ()=> $('#fsMachLabel').textContent=$('#fsMach').value);
    $('#fsGen').addEventListener('click', ()=> genData(parseInt($('#fsJobs').value,10), parseInt($('#fsMach').value,10)) );
    $('#fsRandOrder').addEventListener('click', ()=>{ if(!P.length) genData(parseInt($('#fsJobs').value,10), parseInt($('#fsMach').value,10)); order = [...Array(P.length).keys()].sort(()=>Math.random()-0.5); makespan = makespanOf(order).value; orderNEH=[]; makespanNEH=null; draw(); updateStats(); });
    $('#fsNEH').addEventListener('click', ()=>{ if(!P.length) genData(parseInt($('#fsJobs').value,10), parseInt($('#fsMach').value,10)); if(!order.length){ order = [...Array(P.length).keys()]; makespan = makespanOf(order).value; }
      orderNEH = NEH(); makespanNEH = makespanOf(orderNEH).value; draw(); updateStats(); });
    $('#fsPNG').addEventListener('click', ()=>{ download('flowshop_gantt.png', cvs.toDataURL('image/png')); });

    // init
    function init(){ resize(); genData(parseInt($('#fsJobs').value,10), parseInt($('#fsMach').value,10)); order=[...Array(P.length).keys()].sort(()=>Math.random()-0.5); makespan = makespanOf(order).value; draw(); updateStats(); }
    init();
  })();
  </script>
</body>
</html>
